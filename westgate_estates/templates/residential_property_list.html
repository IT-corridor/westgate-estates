{% extends request.is_ajax|yesno:"ajax.html,base.html" %}

{% block main %}

<div class="col-md-12 middle">
        {% if residentiallist %}
            <div id="map" style="height: 500px; margin-bottom: 12px;"></div>
        {% endif %}
        {% for property in residentiallist %}
        <div class="row">

            <div class="col-sm-4">
                    <a href="{% url 'residential_property_detail' property.SLUG %}">
                    <img class="img-responsive" src="{{ STATIC_URL }}img/properties/{{ property.AGENT_REF }}_IMG_00.JPG" %}" alt="">
                </a>
            </div>
            <div class="col-sm-8">
                <a href="{% url 'residential_property_detail' property.SLUG %}"><h3>{{ property.DISPLAY_ADDRESS }}</h3></a>
                <h4>Bedrooms: {{ property.BEDROOMS }}</h4>
                <p>{{ property.SUMMARY }}</p>
                <a href="{% url 'residential_property_detail' property.SLUG %}" class="btn btn-default btn-lg"><span class="network-name flaticon-home78"> More details</span></a>
            </div>
            <hr />
        </div>     
        {% empty %}
        <div class="row">
            <div class="col-sm-4">
                No properties to display.
            </div>
        </div>
        {% endfor %}
    {% if residentiallist %}
    <script>
      function initMap() {
        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 11,
          center: {lat: 53.8, lng: -1.55}
        });
        var geocoder = new google.maps.Geocoder();
        {% for property in residentiallist %}
            geocodeAddress(geocoder, map, "{{ property.DISPLAY_ADDRESS }}");
        {% endfor %}
      }

      function geocodeAddress(geocoder, resultsMap, address) {
        geocoder.geocode({'address': address}, function(results, status) {
          if (status === google.maps.GeocoderStatus.OK) {
            //resultsMap.setCenter(results[0].geometry.location);
            var marker = new google.maps.Marker({
              map: resultsMap,
              position: results[0].geometry.location
            });
          } else {
            //alert('Geocode was not successful for the following reason: ' + status);
          }
        });
      }
    </script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?callback=initMap"></script>    
    {% endif %}
</div>
{% endblock %}